根据最近的审计结果，CISO 已赋予您为 Amazon S3 存储桶实施持续合规性流程的责任。您能否确保公司的存储桶始终遵循 AWS S3 最佳实践？

您知道该公司不遵循任何变更流程，并且 Amazon S3 中安全性和操作最佳实践的使用好坏参半。您希望确保 Amazon S3 上的安全性和操作最佳实践是标准化的，而与团队无关。由于您的公司有多个 Amazon S3 存储桶，因此逐个存储桶检查合规性将是一项成本高昂且耗时的活动。此外，您知道有些人可能随时尝试回到他们过去的不良做法。

 

来自 <https://jam.awsevents.com/event-10-22/challenges/s-3-config-re-20?t=details> 

 

 

 

 

 

**您的任务**

为您的 Amazon S3 存储桶引入持续合规性流程，并修复任何不符合 Amazon S3 最佳实践的项目。

**背景**

在洗澡时，您意识到您可能可以将 AWS Config Conformance Pack 用于此目的，并且您希望在同一天开始工作。

为此，您需要：

- 设置 AWS config。
- 部署 AWS Conformance Pack 以持续评估 Amazon S3 存储桶的运营最佳实践。
- 为给定的 S3 存储桶实施操作最佳实践。您确定的 Amazon S3 运营最佳实践包括：
  - 不允许对 Amazon S3 存储桶进行公有读写访问。
  - 不允许对 Amazon S3 存储桶进行存储桶级公有访问。
  - 确保为 Amazon S3 存储桶启用版本控制。
  - 确保为 Amazon S3 存储桶启用日志记录。
  - 为 Amazon S3 存储桶启用跨区域复制。
  - 确保 Amazon S3 存储桶具有要求请求使用安全套接字层      （SSL） 的策略。
  - 确保 Amazon S3 存储桶已启用 AWS Key Management Service 密钥 （SSE-KMS） 作为其默认加密。

您部署的一致性包具有许多规则。您只需使存储桶符合上述要求的规则。

**库存**

1. 名称中包含 *-mys3bucket1-* 字符串的 Amazon S3 存储桶。这是需要合规的存储桶。您还可以查看此挑战赛的 **Output     Properties** 部分以查找确切的存储桶名称。
2. IAM 角色：此 IAM 角色用于设置 Amazon S3 存储桶复制。IAM 角色的名称可以在此 JAM 质询的 Output Properties 部分找到，名称为 **myS3ReplRole**。
3. 设置 AWS Config 和 Conformance Pack 时使用的服务相关角色。

**您应该使用的服务**

1. AWS Config
2. 亚马逊 S3
3. AWS KMS（可选）

**任务验证**

1. 部署 AWS Conformance Pack 以持续评估 Amazon S3 存储桶的运营最佳实践。
2. 为给定的 S3 存储桶实施操作最佳实践（有关给定的 Amazon S3 存储桶名称，请参阅上面的 **Inventory** 部分或参阅屏幕左侧的 **Output     Properties** 选项卡）。
3. Jam 环境将继续验证对 s3 存储桶所做的更改，以确定任务的完成情况。如果需要，请使用 **Check my     progress** **（检查我的进度**） 选项自行启动验证检查。

**免責聲明**

请手动解决问题，不要使用 Systems Manager Documents 来解决问题。最终用户没有足够的权限来使用 Systems Manager Document。

您必须创建其他 Amazon S3 存储桶，以实现以下目的：

- 为您的 S3 存储桶设置服务器访问日志记录。
- 为您的 S3 存储桶设置复制。
- 由于 JAM 环境的限制，请在与源存储桶相同的区域中创建复制目标存储桶和目标日志记录存储桶。在实际应用中，这些存储桶可能位于不同的区域或账户中。

要设置 Amazon S3 存储桶的复制，请执行以下操作：

- 请使用此 JAM 挑战赛的“输出属性”部分中给定的 IAM 角色，名称为 **myS3ReplRole** 来设置 Amazon S3 存储桶复制。您没有创建新的 IAM 角色的权限。

**笔记：**

- 您创建的其他 Amazon S3 存储桶无需合规即可完成质询。
- 给定的 Amazon S3 存储桶不应重复用于设置 AWS Config、服务器访问日志或复制。

**蛛丝马迹**

**罚分： 15 点**

线索 1：AWS Config

 

隐藏

 

AWS Config 提供 AWS 账户中 AWS 资源配置的详细视图。点击 URL 了解更多信息 - https://docs.aws.amazon.com/config/latest/developerguide/WhatIsConfig.html

一致性包是 AWS Config 规则和补救措施的集合，可以轻松地作为单个实体部署在账户和区域中，也可以部署在 AWS Organizations 中的整个组织中。点击 URL 了解更多信息 - https://docs.aws.amazon.com/config/latest/developerguide/conformance-packs.html

使用 AWS Config 一致性包 – Amazon S3 的运营最佳实践 – https://docs.aws.amazon.com/config/latest/developerguide/operational-best-practices-for-amazon-s3.html

**罚分： 19 点**

线索 2：AWS 一致性包

 

隐藏

 

使用控制台设置 AWS Config - https://docs.aws.amazon.com/config/latest/developerguide/gs-console.html

使用 AWS Config 一致性包 – Amazon S3 的运营最佳实践 – https://docs.aws.amazon.com/config/latest/developerguide/conformance-pack-console.html#deploy-cpack-using-sample-template

使用 ACL 编辑 Amazon S3 存储桶的公有读/写访问权限 - https://docs.aws.amazon.com/AmazonS3/latest/userguide/managing-acls.html

编辑 Amazon S3 存储桶的公有访问设置 - https://docs.aws.amazon.com/AmazonS3/latest/user-guide/block-public-access-bucket.html

为 Amazon S3 存储桶启用版本控制 - https://docs.aws.amazon.com/AmazonS3/latest/user-guide/enable-versioning.html

为 Amazon S3 存储桶启用服务器访问日志记录 - https://docs.aws.amazon.com/AmazonS3/latest/user-guide/server-access-logging.html

向 Amazon S3 存储桶添加复制规则 - https://docs.aws.amazon.com/AmazonS3/latest/user-guide/enable-replication.html

确保 S3 存储桶具有要求请求使用安全套接字层 （SSL） 的策略 - https://aws.amazon.com/premiumsupport/knowledge-center/s3-bucket-policy-for-config-rule/

使用 AWS KMS 为 Amazon S3 存储桶启用服务器端加密 - https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingKMSEncryption.html

**罚分： 22 点**

线索 3：AWS 一致性包 – AWS S3 的运营最佳实践

 

隐藏

 

**设置 AWS Config**

1. 打开 AWS 控制台，然后导航到 AWS Config 或直接在 https://console.aws.amazon.com/config/ 中打开     AWS Config 控制台
2. 选择 **Get     Started（开始使用**）。
3. 在 **Settings     （设置**）     页面的 **Recording method （录制方法**） 下，对于 **Recording strategy （录制策略**），选择 **Specific     resource types （特定资源类型**）。在 **Resource types to     record（要记录的资源类型**）下，对于 **Resource     type（资源类型**），选择 **AWS S3     Bucket（AWS S3 存储桶**），对于 **Frequency（频率），**选择 **Continuous（连续**）。
4. 对于 **AWS     Config 的 IAM 角色，**选择**从您的账户中选择角色**。
5. 从 **Existing     roles** 下拉菜单中，选择 **AWSServiceRoleForConfig**。
6. 对于 **Amazon     S3 Bucket （Amazon S3 存储桶**），选择 **Create a bucket （创建存储桶**）。对于 **Bucket     Name （存储桶名称**），配置将自动添加默认名称，您可以像这样保留它。
7. 对于 **Amazon     SNS Topic （Amazon SNS 主题**），请将其保持未选中状态。
8. 选择 **Next     （下一步**）。
9. 不要选择任何规则，然后选择 **Next（下一步**）。
10. 查看设置，然后选择 **Confirm**

**部署 AWS Conformance Pack - Amazon S3 操作最佳实践**

1. 打开 AWS 控制台，然后导航到 AWS Config 或直接在 https://console.aws.amazon.com/config/ 中打开     AWS Config 控制台
2. 导航到 **Conformance     packs （一致性包**）     页面，然后选择 **Deploy conformance pack （部署一致性包**）。
3. 在 **Specify     template （指定模板**）     页面上，选择一个示例模板。
4. 在 Sample Template （示例模板）     复选框中键入 S3 以筛选一致性包，然后选择 **Amazon S3 的运营最佳实践**
5. 选择 **Next     （下一步**）。
6. 在 **Specify     conformance pack details （指定一致性包详细信息**） 页面上，键入一致性包的名称。（示例：ops-best-s3）
7. 跳过 Parameters - optional     部分。
8. 选择 **Next     （下一步**）。
9. 在 **Review     and deploy （查看和部署**） 页面上，查看所有信息。
10. 选择 **Deploy     conformance pack （部署一致性包**）。

**免責聲明**请手动解决问题，不要使用 Systems Manager Documents 来解决问题。最终用户没有足够的权限来使用 Systems Manager Document。

**使用 ACL 编辑 Amazon S3 存储桶的公有读/写访问权限**

1. 打开 AWS 控制台，然后导航到 S3 控制台或直接在 https://console.aws.amazon.com/s3/ 中打开     Amazon S3 控制台
2. 在 **Bucket     name （存储桶名称**）     列表中，选择要编辑其 ACL 设置以进行公有读取和写入的存储桶，然后选择 **Permissions （权限）** 选项卡。
3. 在 **Access     control list （ACL） （访问控制列表 （ACL）** ） 部分中，选择 **Edit （编辑**）。
4. 在 **Everyone     （public access） Grantee（所有人（公共访问）**被授权者）下，取消选择所有选项。
5. 选择 **Save     changes（保存更改**）。

**编辑 Amazon S3 存储桶的公有访问设置**

1. 打开 AWS 控制台，然后导航到 S3 控制台或直接在 https://console.aws.amazon.com/s3/ 中打开     Amazon S3 控制台
2. 在 **Bucket     name （存储桶名称**）     列表中，选择要编辑其公有访问设置的存储桶，然后选择 **Permissions （权限）** 选项卡。
3. 在 **Block     public access （bucket settings） （阻止公有访问（存储桶设置）**） 部分中，选择 **Edit（编辑**），然后选中最顶部的复选框 **Block     all public access（阻止所有公有访问**）（这也将选中以下 4 个复选框），然后选择 **Save     changes（保存更改**）。
4. 当系统要求您确认时，请输入     confirm。然后选择 **Confirm （确认**） 以保存您的更改。

**为 Amazon S3 存储桶启用版本控制**

1. 打开 AWS 控制台，然后导航到 S3 控制台或直接在 https://console.aws.amazon.com/s3/ 中打开     Amazon S3 控制台
2. 在 **Bucket     name （存储桶名称**）     列表中，选择要为其启用版本控制的存储桶的名称。
3. 选择 **Properties     （属性**） 选项卡。
4. 在 **Bucket     versioning （存储桶版本控制**） 部分下，选择 **Edit （编辑**）。
5. 选择 **Enable     （启用**），然后选择 **Save     changes （保存更改**）。

**为 Amazon S3 存储桶启用服务器访问日志记录**

1. 打开 AWS 控制台，然后导航到 S3 控制台或直接在 https://console.aws.amazon.com/s3/ 中打开     Amazon S3 控制台
2. 选择 **Create     bucket （创建存储桶**）。
3. 在 **Bucket     name （存储桶名称**）     下，输入一个唯一的可识别名称，例如 *my-jam-logging-bucket-*。
4. 确保将区域设置为挑战的同一区域。
5. 选择 **Create     bucket （创建存储桶**）。
6. 在 **Buckets     （存储桶）** 列表中，选择要为其启用服务器访问日志记录的存储桶的名称。
7. 选择 **Properties     （属性**） 选项卡。
8. 在 **Server     access logging （服务器访问日志记录**） 部分中，选择 **Edit （编辑**）。
9. 选择 **Enable**。
10. 对于 **Target     bucket （目标存储桶**），选择 **Browse     S3 （浏览 S3**）     并选择您为日志记录创建的存储桶的名称，然后选择 **Choose path （选择路径**）。
11. 选择 **Save     changes（保存更改**）。

**向 Amazon S3 存储桶添加复制规则**

1. 打开 AWS 控制台，然后导航到 S3 控制台或直接在 https://console.aws.amazon.com/s3/ 中打开     Amazon S3 控制台
2. 选择 **Create     bucket （创建存储桶**）。
3. 在 **Bucket     name （存储桶名称**）     下，输入一个唯一的可识别名称，例如 *my-jam-replication-bucket-*。此存储桶将用作复制的目标存储桶。
4. 确保该区域与挑战的同一区域相同。**注意：**在实际场景中，您的源 Amazon S3     存储桶和目标 Amazon S3 存储桶将位于两个不同的区域，但由于 AWS JAM 环境的限制，我们将在同一区域中创建源 Amazon S3     存储桶和目标 Amazon S3 存储桶。
5. 在 **Bucket     versioning （存储桶版本控制**） 部分下，选择 **Enable （启用**）。
6. 选择 **Create     bucket （创建存储桶**）。
7. 在 **Buckets     （存储桶）** 列表中，选择要为其启用复制的存储桶的名称。
8. 选择 **Management     （管理）** 选项卡，然后在 **Replication     rules （复制规则**）     部分下，选择 **Create replication rule （创建复制规则**）。
9. 在 **Create     replication rule （创建复制规则**） 页面的 **Replication rule name （复制规则名称**） 下，输入 *my-rule*。
10. 在 **Source     bucket （源存储桶**）     部分中，选择 **Apply to all objects in the bucket （应用于存储桶中的所有对象**）。
11. 在 **Destination     （目标**）     部分中，选择 **Choose a bucket in this account （选择此账户中的存储桶**），然后选择 **Browse     S3 （浏览 S3**）     并选择您为复制创建的存储桶的名称，然后选择 **Choose path （选择路径**）。
12. 在 **IAM role     （IAM 角色**）     部分中，选择 **Choose from existing IAM roles （从现有 IAM 角色中选择**）。然后，在 **IAM role** 下拉菜单中，选择此 JAM 质询的     Output Properties （输出属性） 中提供的给定 IAM 角色，其名称为 **myS3ReplRole**。
13. 选择 **Save （保存**）。
14. 选择 **Submit     （提交**）。

**确保 S3 存储桶具有要求请求使用安全套接字层 （SSL） 的策略**

1. 打开 AWS 控制台，然后导航到 S3 控制台或直接在 https://console.aws.amazon.com/s3/ 中打开     Amazon S3 控制台
2. 在 **Bucket     name （存储桶名称**）     列表中，选择要编辑其策略的存储桶的名称。
3. 选择 **Permissions     （权限**）     选项卡，然后在 **Bucket Policy （存储桶策略**） 部分中，选择 **Edit （编辑**）。
4. 在 **Bucket policy editor （存储桶策略编辑器**）     文本框中，键入或复制并粘贴此引用链接 （ https://aws.amazon.com/premiumsupport/knowledge-center/s3-bucket-policy-for-config-rule/）     中的存储桶策略，然后编辑策略中**存储桶的名称**。**注意：**存储桶策略是一个 JSON 文件。您在编辑器中键入的文本必须是有效的 JSON。
5. 选择 **Save     changes（保存更改**）。

**使用 AWS KMS 为 Amazon S3 存储桶启用服务器端加密**

1. 打开 AWS 控制台，然后导航到 S3 控制台或直接在 https://console.aws.amazon.com/s3/ 中打开     Amazon S3 控制台
2. 在 **Bucket     name （存储桶名称**）     列表中，选择要为其启用服务器端加密设置的存储桶的名称。
3. 选择 **Properties     （属性**） 选项卡。
4. 在 **Default     encryption （默认加密**） 部分中，选择 **Edit （编辑**）。
5. 对于 **Encryption     key type （加密密钥类型），选择 AWS Key Management Service key （SSE-KMS） （AWS Key     Management Service key （SSE-KMS）**）。
6. 对于 **AWS KMS     密钥**，选择 **Choose     from your AWS KMS keys （从您的 AWS KMS 密钥中选择**）。
7. 在 **Available     AWS KMS keys （可用 AWS KMS 密钥**） 下拉菜单中，选择以 **aws/s3** 结尾的密钥 ARN。这是用于 S3     加密的 AWS 托管 KMS 密钥。
8. 选择 **Save     changes（保存更改**）。

**笔记：**

- 完成上述所有步骤后，AWS Config     一致性包应根据您配置的所选合规性标准，将合规性状态自动更新为 Compliant（合规）。这可能需要几分钟才能完成。
- 对于质询中的其他存储桶，所需的规则可能仍会显示     Noncompliant （不合规） 状态，这应该没问题。挑战赛的目标是使 *mys3bucket1* 存储桶合规。
- 一致性包中还有其他规则仍显示     Noncompliant 状态，但这些规则不是本次质询所必需的。

 

来自 <https://jam.awsevents.com/event-10-22/challenges/s-3-config-re-20?t=details> 

 

 

 