![image-20241023102518302](./img/image-20241023102518302.png)

### 任务 1：使用 IPv4 从本地查询 AWS



这种用于减少多 VPC 配置中的互联网接入点的模式现在通常称为 ______ VPC 模式。输入模式名称以完成此任务。

Egress 





### 任务 2：使用 IPv6 从本地查询 AWS

![image-20241023103100184](./img/image-20241023103100184.png)

### 步骤 1：注意 VPC IPv6 CIDR

打开 Amazon VPC 控制台https://console.aws.amazon.com/vpc/。

- 在导航窗格上，选择`Your VPCs`。
- `VPC ID`从一个名为 中选择`Onprem-Side`。
- 选择`CIDRs`标签。
- 注意名为 的列中的 IPv6 CIDR `CIDR`。
- 在导航窗格上，选择`Your VPCs`。
- `VPC ID`从一个名为 中选择`AWS-Side`。
- 选择`CIDRs`标签。
- 注意名为 的列中的 IPv6 CIDR `CIDR`。

------

### 第 2 步：修复路由表

打开 Amazon VPC 控制台https://console.aws.amazon.com/vpc/。

- 在导航窗格上，选择`Route tables`。
- `Route table ID`从一个名为 中选择`Onprem-Side-Private`。
- 在`Routes`选项卡上，选择`Edit routes`。
- 选择`Add route`。
- 在`Destination`文本框字段上，添加来自`AWS-Side`VPC 的 IPv6 CIDR 范围。
- 在`Target`选择字段上，选择`Transit Gateway`。
- 在下面显示的文本框中，选择名为的 Transit Gateway `Jam`。
- 选择`Save changes`。
- 在导航窗格上，选择`Route tables`。
- `Route table ID`从一个名为 中选择`AWS-Side-Private`。
- 在`Routes`选项卡上，选择`Edit routes`。
- 选择`Add route`。
- 在`Destination`文本框字段上，添加来自`Onprem-Side`VPC 的 IPv6 CIDR 范围。
- 在`Target`选择字段上，选择`Transit Gateway`。
- 在下面显示的文本框中，选择名为的 Transit Gateway `Jam`。
- 选择`Save changes`。

------

### 步骤 3：修复安全组

打开 Amazon VPC 控制台https://console.aws.amazon.com/vpc/。

- 在导航窗格上，选择`Security groups`。
- `Security group ID`从一个名为 中选择`AWS-Side-Endpoint`。
- 在`Inbound rules`选项卡上，选择`Edit inbound rules`。
- 选择`Add rule`。
- 在`Type`选择字段上，选择`DNS (UDP)`。
- 在`Source`文本框字段上，添加来自`Onprem-Side`VPC 的 IPv6 CIDR 范围。
- 选择`Add rule`。
- 在`Type`选择字段上，选择`DNS (TCP)`。
- 在`Source`文本框字段上，添加来自`Onprem-Side`VPC 的 IPv6 CIDR 范围。
- 选择`Save rules`。

------

### 步骤 4：记下入站端点的 IP 地址

打开 Amazon Route 53 控制台： https: [//console.aws.amazon.com/route53/](https://console.aws.amazon.com/route53/)。

- 在导航窗格上，选择`Inbound endpoints`。
- 选择名为 的入站端点`AWS-Side-Inbound`。
- 在面板上`IP addresses`，记下列中的任何 IPv6 地址`IPv6 address`。

------

### 步骤 5：连接会话管理器

要使用 Amazon EC2 控制台中的会话管理器连接到 Linux 实例，
请打开 Amazon EC2 控制台https://console.aws.amazon.com/ec2/。

- 在导航窗格中，选择`Instances`。
- 选择所调用的实例并在顶部`Onprem-Test-IPv6-Only`选择。`Connect`
- 选择`Session Manager`标签。
- 选择`Connect`。

------

#### ⚠👁 注意！

无需在任何其他 EC2 实例上执行任何操作。
您只需通过 Session Manager 连接到实例控制台即可。

------

### 步骤 6：IPv6`dig`命令

**在 Linux 控制台中运行输出属性**中名为**Task2ValidateCommand**的命令。

```
AWS-Side-Inbound IPv6 HERE`用您从入站端点获得的正确 IPv6 地址进行替换。
两个入站 IPv6 地址中的任意一个。
例如：`dig +short task-b.aws.internal TXT @2600:1f1e:d30:b200:aad6:7434:f57c:6305
```

请参阅下面的示例。这些 IP 地址仅供参考，您需要从挑战环境中获取正确的 IP 地址。









### 任务 3：使用 IPv4 从 AWS 进行本地查询

![image-20241023145239237](./img/image-20241023145239237.png)

### 步骤 1：记下入站端点的 IP 地址

打开 Amazon Route 53 控制台： https: [//console.aws.amazon.com/route53/](https://console.aws.amazon.com/route53/)。

- 在导航窗格上，选择`Inbound endpoints`。
- 选择名为 的入站端点`Onprem-Side-Inbound`。
- 在`IP addresses`面板上，记下列中的 IPv4 地址`IP address`。

------

### 第 2 步：修复解析器规则

打开 Amazon Route 53 控制台： https: [//console.aws.amazon.com/route53/](https://console.aws.amazon.com/route53/)。

- 在导航窗格上，选择`Rules`“解析器”。
- 选择一个名为`ipv4-onprem-internal`。
- 在`Target IP addresses`面板上，选择`Add target IP address`。
- 开启`IP Address Type`，选择`IPv4`。
- 在 上，用您之前记下的一个 IPv4 地址`IPv4 address`替换。`1.1.1.1`
- 选择`Add target`。
- 在 上`IPv4 address`，添加您之前记下的另一个 IPv4 地址。
- 开启`Transmission Protocol`，选择`Do53`。
- 选择`Add`。
- 等到状态为`Complete`。

![image-20241023145422212](./img/image-20241023145422212.png)

------

### 步骤 3：连接会话管理器

要使用 Amazon EC2 控制台中的会话管理器连接到 Linux 实例，
请打开 Amazon EC2 控制台https://console.aws.amazon.com/ec2/。

- 在导航窗格中，选择`Instances`。
- 选择所调用的实例并在顶部`AWS-Test-IPv4-Only`选择。`Connect`
- 选择`Session Manager`标签。
- 选择`Connect`。

------

#### ⚠👁 注意！

无需在任何其他 EC2 实例上执行任何操作。
您只需通过 Session Manager 连接到实例控制台即可。

------

### 步骤 4：IPv6`dig`命令

**在 Linux 控制台中运行输出属性**中名为**Task3ValidateCommand**的命令。

例子：

```shell
sh-4.2$ dig +short task-c.ipv4.onprem.internal TXT
"Great!!! If you used the correct instance, task may be completed. If nothing else is still pending for this task."
```





任务4：

![image-20241023175702556](./img/image-20241023175702556.png)
