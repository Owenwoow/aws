![image-20241023102518302](./img/image-20241023102518302.png)

### ä»»åŠ¡ 1ï¼šä½¿ç”¨ IPv4 ä»æœ¬åœ°æŸ¥è¯¢ AWS



è¿™ç§ç”¨äºå‡å°‘å¤š VPC é…ç½®ä¸­çš„äº’è”ç½‘æ¥å…¥ç‚¹çš„æ¨¡å¼ç°åœ¨é€šå¸¸ç§°ä¸º ______ VPC æ¨¡å¼ã€‚è¾“å…¥æ¨¡å¼åç§°ä»¥å®Œæˆæ­¤ä»»åŠ¡ã€‚

Egress 





### ä»»åŠ¡ 2ï¼šä½¿ç”¨ IPv6 ä»æœ¬åœ°æŸ¥è¯¢ AWS

![image-20241023103100184](./img/image-20241023103100184.png)

### æ­¥éª¤ 1ï¼šæ³¨æ„ VPC IPv6 CIDR

æ‰“å¼€ Amazon VPC æ§åˆ¶å°https://console.aws.amazon.com/vpc/ã€‚

- åœ¨å¯¼èˆªçª—æ ¼ä¸Šï¼Œé€‰æ‹©`Your VPCs`ã€‚
- `VPC ID`ä»ä¸€ä¸ªåä¸º ä¸­é€‰æ‹©`Onprem-Side`ã€‚
- é€‰æ‹©`CIDRs`æ ‡ç­¾ã€‚
- æ³¨æ„åä¸º çš„åˆ—ä¸­çš„ IPv6 CIDR `CIDR`ã€‚
- åœ¨å¯¼èˆªçª—æ ¼ä¸Šï¼Œé€‰æ‹©`Your VPCs`ã€‚
- `VPC ID`ä»ä¸€ä¸ªåä¸º ä¸­é€‰æ‹©`AWS-Side`ã€‚
- é€‰æ‹©`CIDRs`æ ‡ç­¾ã€‚
- æ³¨æ„åä¸º çš„åˆ—ä¸­çš„ IPv6 CIDR `CIDR`ã€‚

------

### ç¬¬ 2 æ­¥ï¼šä¿®å¤è·¯ç”±è¡¨

æ‰“å¼€ Amazon VPC æ§åˆ¶å°https://console.aws.amazon.com/vpc/ã€‚

- åœ¨å¯¼èˆªçª—æ ¼ä¸Šï¼Œé€‰æ‹©`Route tables`ã€‚
- `Route table ID`ä»ä¸€ä¸ªåä¸º ä¸­é€‰æ‹©`Onprem-Side-Private`ã€‚
- åœ¨`Routes`é€‰é¡¹å¡ä¸Šï¼Œé€‰æ‹©`Edit routes`ã€‚
- é€‰æ‹©`Add route`ã€‚
- åœ¨`Destination`æ–‡æœ¬æ¡†å­—æ®µä¸Šï¼Œæ·»åŠ æ¥è‡ª`AWS-Side`VPC çš„ IPv6 CIDR èŒƒå›´ã€‚
- åœ¨`Target`é€‰æ‹©å­—æ®µä¸Šï¼Œé€‰æ‹©`Transit Gateway`ã€‚
- åœ¨ä¸‹é¢æ˜¾ç¤ºçš„æ–‡æœ¬æ¡†ä¸­ï¼Œé€‰æ‹©åä¸ºçš„ Transit Gateway `Jam`ã€‚
- é€‰æ‹©`Save changes`ã€‚
- åœ¨å¯¼èˆªçª—æ ¼ä¸Šï¼Œé€‰æ‹©`Route tables`ã€‚
- `Route table ID`ä»ä¸€ä¸ªåä¸º ä¸­é€‰æ‹©`AWS-Side-Private`ã€‚
- åœ¨`Routes`é€‰é¡¹å¡ä¸Šï¼Œé€‰æ‹©`Edit routes`ã€‚
- é€‰æ‹©`Add route`ã€‚
- åœ¨`Destination`æ–‡æœ¬æ¡†å­—æ®µä¸Šï¼Œæ·»åŠ æ¥è‡ª`Onprem-Side`VPC çš„ IPv6 CIDR èŒƒå›´ã€‚
- åœ¨`Target`é€‰æ‹©å­—æ®µä¸Šï¼Œé€‰æ‹©`Transit Gateway`ã€‚
- åœ¨ä¸‹é¢æ˜¾ç¤ºçš„æ–‡æœ¬æ¡†ä¸­ï¼Œé€‰æ‹©åä¸ºçš„ Transit Gateway `Jam`ã€‚
- é€‰æ‹©`Save changes`ã€‚

------

### æ­¥éª¤ 3ï¼šä¿®å¤å®‰å…¨ç»„

æ‰“å¼€ Amazon VPC æ§åˆ¶å°https://console.aws.amazon.com/vpc/ã€‚

- åœ¨å¯¼èˆªçª—æ ¼ä¸Šï¼Œé€‰æ‹©`Security groups`ã€‚
- `Security group ID`ä»ä¸€ä¸ªåä¸º ä¸­é€‰æ‹©`AWS-Side-Endpoint`ã€‚
- åœ¨`Inbound rules`é€‰é¡¹å¡ä¸Šï¼Œé€‰æ‹©`Edit inbound rules`ã€‚
- é€‰æ‹©`Add rule`ã€‚
- åœ¨`Type`é€‰æ‹©å­—æ®µä¸Šï¼Œé€‰æ‹©`DNS (UDP)`ã€‚
- åœ¨`Source`æ–‡æœ¬æ¡†å­—æ®µä¸Šï¼Œæ·»åŠ æ¥è‡ª`Onprem-Side`VPC çš„ IPv6 CIDR èŒƒå›´ã€‚
- é€‰æ‹©`Add rule`ã€‚
- åœ¨`Type`é€‰æ‹©å­—æ®µä¸Šï¼Œé€‰æ‹©`DNS (TCP)`ã€‚
- åœ¨`Source`æ–‡æœ¬æ¡†å­—æ®µä¸Šï¼Œæ·»åŠ æ¥è‡ª`Onprem-Side`VPC çš„ IPv6 CIDR èŒƒå›´ã€‚
- é€‰æ‹©`Save rules`ã€‚

------

### æ­¥éª¤ 4ï¼šè®°ä¸‹å…¥ç«™ç«¯ç‚¹çš„ IP åœ°å€

æ‰“å¼€ Amazon Route 53 æ§åˆ¶å°ï¼š https: [//console.aws.amazon.com/route53/](https://console.aws.amazon.com/route53/)ã€‚

- åœ¨å¯¼èˆªçª—æ ¼ä¸Šï¼Œé€‰æ‹©`Inbound endpoints`ã€‚
- é€‰æ‹©åä¸º çš„å…¥ç«™ç«¯ç‚¹`AWS-Side-Inbound`ã€‚
- åœ¨é¢æ¿ä¸Š`IP addresses`ï¼Œè®°ä¸‹åˆ—ä¸­çš„ä»»ä½• IPv6 åœ°å€`IPv6 address`ã€‚

------

### æ­¥éª¤ 5ï¼šè¿æ¥ä¼šè¯ç®¡ç†å™¨

è¦ä½¿ç”¨ Amazon EC2 æ§åˆ¶å°ä¸­çš„ä¼šè¯ç®¡ç†å™¨è¿æ¥åˆ° Linux å®ä¾‹ï¼Œ
è¯·æ‰“å¼€ Amazon EC2 æ§åˆ¶å°https://console.aws.amazon.com/ec2/ã€‚

- åœ¨å¯¼èˆªçª—æ ¼ä¸­ï¼Œé€‰æ‹©`Instances`ã€‚
- é€‰æ‹©æ‰€è°ƒç”¨çš„å®ä¾‹å¹¶åœ¨é¡¶éƒ¨`Onprem-Test-IPv6-Only`é€‰æ‹©ã€‚`Connect`
- é€‰æ‹©`Session Manager`æ ‡ç­¾ã€‚
- é€‰æ‹©`Connect`ã€‚

------

#### âš ğŸ‘ æ³¨æ„ï¼

æ— éœ€åœ¨ä»»ä½•å…¶ä»– EC2 å®ä¾‹ä¸Šæ‰§è¡Œä»»ä½•æ“ä½œã€‚
æ‚¨åªéœ€é€šè¿‡ Session Manager è¿æ¥åˆ°å®ä¾‹æ§åˆ¶å°å³å¯ã€‚

------

### æ­¥éª¤ 6ï¼šIPv6`dig`å‘½ä»¤

**åœ¨ Linux æ§åˆ¶å°ä¸­è¿è¡Œè¾“å‡ºå±æ€§**ä¸­åä¸º**Task2ValidateCommand**çš„å‘½ä»¤ã€‚

```
AWS-Side-Inbound IPv6 HERE`ç”¨æ‚¨ä»å…¥ç«™ç«¯ç‚¹è·å¾—çš„æ­£ç¡® IPv6 åœ°å€è¿›è¡Œæ›¿æ¢ã€‚
ä¸¤ä¸ªå…¥ç«™ IPv6 åœ°å€ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚
ä¾‹å¦‚ï¼š`dig +short task-b.aws.internal TXT @2600:1f1e:d30:b200:aad6:7434:f57c:6305
```

è¯·å‚é˜…ä¸‹é¢çš„ç¤ºä¾‹ã€‚è¿™äº› IP åœ°å€ä»…ä¾›å‚è€ƒï¼Œæ‚¨éœ€è¦ä»æŒ‘æˆ˜ç¯å¢ƒä¸­è·å–æ­£ç¡®çš„ IP åœ°å€ã€‚









### ä»»åŠ¡ 3ï¼šä½¿ç”¨ IPv4 ä» AWS è¿›è¡Œæœ¬åœ°æŸ¥è¯¢

![image-20241023145239237](./img/image-20241023145239237.png)

### æ­¥éª¤ 1ï¼šè®°ä¸‹å…¥ç«™ç«¯ç‚¹çš„ IP åœ°å€

æ‰“å¼€ Amazon Route 53 æ§åˆ¶å°ï¼š https: [//console.aws.amazon.com/route53/](https://console.aws.amazon.com/route53/)ã€‚

- åœ¨å¯¼èˆªçª—æ ¼ä¸Šï¼Œé€‰æ‹©`Inbound endpoints`ã€‚
- é€‰æ‹©åä¸º çš„å…¥ç«™ç«¯ç‚¹`Onprem-Side-Inbound`ã€‚
- åœ¨`IP addresses`é¢æ¿ä¸Šï¼Œè®°ä¸‹åˆ—ä¸­çš„ IPv4 åœ°å€`IP address`ã€‚

------

### ç¬¬ 2 æ­¥ï¼šä¿®å¤è§£æå™¨è§„åˆ™

æ‰“å¼€ Amazon Route 53 æ§åˆ¶å°ï¼š https: [//console.aws.amazon.com/route53/](https://console.aws.amazon.com/route53/)ã€‚

- åœ¨å¯¼èˆªçª—æ ¼ä¸Šï¼Œé€‰æ‹©`Rules`â€œè§£æå™¨â€ã€‚
- é€‰æ‹©ä¸€ä¸ªåä¸º`ipv4-onprem-internal`ã€‚
- åœ¨`Target IP addresses`é¢æ¿ä¸Šï¼Œé€‰æ‹©`Add target IP address`ã€‚
- å¼€å¯`IP Address Type`ï¼Œé€‰æ‹©`IPv4`ã€‚
- åœ¨ ä¸Šï¼Œç”¨æ‚¨ä¹‹å‰è®°ä¸‹çš„ä¸€ä¸ª IPv4 åœ°å€`IPv4 address`æ›¿æ¢ã€‚`1.1.1.1`
- é€‰æ‹©`Add target`ã€‚
- åœ¨ ä¸Š`IPv4 address`ï¼Œæ·»åŠ æ‚¨ä¹‹å‰è®°ä¸‹çš„å¦ä¸€ä¸ª IPv4 åœ°å€ã€‚
- å¼€å¯`Transmission Protocol`ï¼Œé€‰æ‹©`Do53`ã€‚
- é€‰æ‹©`Add`ã€‚
- ç­‰åˆ°çŠ¶æ€ä¸º`Complete`ã€‚

![image-20241023145422212](./img/image-20241023145422212.png)

------

### æ­¥éª¤ 3ï¼šè¿æ¥ä¼šè¯ç®¡ç†å™¨

è¦ä½¿ç”¨ Amazon EC2 æ§åˆ¶å°ä¸­çš„ä¼šè¯ç®¡ç†å™¨è¿æ¥åˆ° Linux å®ä¾‹ï¼Œ
è¯·æ‰“å¼€ Amazon EC2 æ§åˆ¶å°https://console.aws.amazon.com/ec2/ã€‚

- åœ¨å¯¼èˆªçª—æ ¼ä¸­ï¼Œé€‰æ‹©`Instances`ã€‚
- é€‰æ‹©æ‰€è°ƒç”¨çš„å®ä¾‹å¹¶åœ¨é¡¶éƒ¨`AWS-Test-IPv4-Only`é€‰æ‹©ã€‚`Connect`
- é€‰æ‹©`Session Manager`æ ‡ç­¾ã€‚
- é€‰æ‹©`Connect`ã€‚

------

#### âš ğŸ‘ æ³¨æ„ï¼

æ— éœ€åœ¨ä»»ä½•å…¶ä»– EC2 å®ä¾‹ä¸Šæ‰§è¡Œä»»ä½•æ“ä½œã€‚
æ‚¨åªéœ€é€šè¿‡ Session Manager è¿æ¥åˆ°å®ä¾‹æ§åˆ¶å°å³å¯ã€‚

------

### æ­¥éª¤ 4ï¼šIPv6`dig`å‘½ä»¤

**åœ¨ Linux æ§åˆ¶å°ä¸­è¿è¡Œè¾“å‡ºå±æ€§**ä¸­åä¸º**Task3ValidateCommand**çš„å‘½ä»¤ã€‚

ä¾‹å­ï¼š

```shell
sh-4.2$ dig +short task-c.ipv4.onprem.internal TXT
"Great!!! If you used the correct instance, task may be completed. If nothing else is still pending for this task."
```





ä»»åŠ¡4ï¼š

![image-20241023175702556](./img/image-20241023175702556.png)
