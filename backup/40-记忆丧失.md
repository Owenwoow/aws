**记忆丧失**

![image-20241023183242255](./img/image-20241023183242255.png)

要完成在 AWS 控制台中显示 EC2 实例内存使用情况的任务，请按照以下步骤操作：

### 1.确保 AWS Systems Manager 可以管理 EC2 实例

#### 步骤 1：将 IAM 角色附加到 EC2 实例

1. 打开**EC2**控制台并选择您的实例。
2. 在**描述选项**卡中，找到**IAM 角色**并单击它。
3. 这将带您进入 IAM 控制台。在这里，您可以看到附加到您的 EC2 实例的角色。

#### 步骤 2：使用必要的权限更新 IAM 角色

1. **在IAM**控制台中，选择附加到您的 EC2 实例的角色。

2. 单击**添加内联策略**。

3. 使用**JSON**选项卡并粘贴基于以下策略`CloudWatchAgentServerPolicy`：

   ```
   json复制代码{
       "Version": "2012-10-17",
       "Statement": [
           {
               "Effect": "Allow",
               "Action": [
                   "cloudwatch:PutMetricData",
                   "ec2:DescribeTags",
                   "logs:PutLogEvents",
                   "logs:DescribeLogStreams",
                   "logs:DescribeLogGroups",
                   "logs:CreateLogStream",
                   "logs:CreateLogGroup"
               ],
               "Resource": "*"
           }
       ]
   }
   ```

4. 单击**审核策略**，为其命名（例如`CloudWatchAgentPolicy`），然后创建策略。

#### 步骤 3：确保安全组允许出站互联网访问

1. **在EC2**控制台中，选择您的实例。
2. 在**“描述”**选项卡中，找到**安全组**并单击它。
3. 确保存在允许端口 443 (HTTPS) 上的流量的出站规则。

### 2.安装并配置 CloudWatch 代理

#### 使用 AWS Systems Manager Distributor

1. 打开**AWS Systems Manager**控制台。
2. 在导航窗格中，选择**Distributor (分发服务器)**。
3. 查找并选择**AmazonCloudWatchAgent**包。
4. 选择**“一次性安装”**。
5. 选择**手动选择实例**，然后选择您的 EC2 实例。
6. 取消选中**“启用写入 S3 存储桶”**并单击**“运行”**。

#### 配置 CloudWatch 代理

1. 在**AWS Systems Manager**控制台中，转到**文档**。

2. 搜索名称前缀为**AmazonCloudWatch 的**文档并选择**AmazonCloudWatch-ManageAgent**。

3. 选择具有以下选项的

   运行命令：

   

   - **操作**：配置
   - **模式**：ec2
   - **可选配置源**：默认
   - **可选重启**：是

4. 选择**手动选择实例**并选择您的 EC2 实例。

5. 取消选中**“启用写入 S3 存储桶”**并单击**“运行”**。

### 3.验证 CloudWatch 指标

1. 打开**CloudWatch**控制台。
2. 在导航窗格中，选择**Metrics (指标)**。
3. 几分钟后，**CWAgent**命名空间就会出现。
4. 单击**CWAgent**命名空间。
5. 找到维度组**ImageId、InstanceId、InstanceType**并点击。
6. 确认**mem_used_percent**指标可用并在图表中查看其最新观察结果。

通过遵循这些步骤，您应该能够在 AWS 控制台中查看、绘制和监控 EC2 实例使用的内存。

要设置在 EC2 实例的内存使用量超过 75% 时发送电子邮件通知，请按照以下步骤操作：

### 1.创建 CloudWatch 内存使用警报

#### 步骤 1：打开 CloudWatch 指标

1. 从 AWS 管理控制台打开**CloudWatch控制台。**
2. 在导航窗格中，单击**“Metrics”**。
3. 单击**自定义命名空间**下的**CWAgent**命名空间。
4. 点击**ImageId、InstanceId、InstanceType**维度集合。
5. 为您的 EC2 实例选择**mem_used_percent**指标。

#### 步骤 2：创建警报

1. 单击**“图形指标”**选项卡。

2. 在指标的**操作**列中，单击铃铛图标来创建警报。

3. 在

   条件

   部分：

   - 将阈值类型设置为**静态**。
   - 将条件设置为**大于**...。
   - 输入`75`作为阈值。
   - 单击**“下一步”**。

### 2. 设置 SNS 以接收通知

#### 步骤 1：创建新的 SNS 主题

1. 在**通知**部分中，选择**报警中**。
2. 选择**创建新主题**。
3. 输入主题的名称，例如`Alarm-Memory-High`。
4. 在**将接收通知的电子邮件端点**文本框中，输入您的电子邮件地址。
5. 单击**创建主题**。

#### 第 2 步：确认订阅

1. 检查您的电子邮件，查找来自 AWS 的订阅确认消息。
2. 点击电子邮件中提供的链接确认订阅。

### 3. 完成警报配置

1. 在**警报名称**部分，输入一个描述性名称，例如`Alarm-Memory-High-Dev-Server`。
2. （可选）输入警报的描述。
3. 单击**“下一步”**。
4. 检查警报配置并单击**“创建警报”**。

### 概括

现在，当您的 EC2 实例的内存使用率超过 75% 时，将向指定的电子邮件地址发送电子邮件通知。此设置可确保您及时收到有关高内存使用率的通知，以便您采取必要的措施。